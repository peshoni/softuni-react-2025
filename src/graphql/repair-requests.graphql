
query GetRepairRequests($limit: Int, $offset: Int, $condition: repair_requests_bool_exp! = {}, $orderBy: [repair_requests_order_by!] = {created_at: asc}) {
  repair_requests(where: $condition, limit: $limit, offset: $offset, order_by: $orderBy) {
    ...repair_request
  }
  repair_requests_aggregate(where: $condition) {
    aggregate {
      count
    }
  }
}

query GetRepairRequestById ($id:uuid!) {
  repair_requests_by_pk(id:$id){
    ...repair_request_with_logs
  }
}

mutation UpsertRepairRequestLog($object: requests_logs_insert_input!) {
  insert_requests_logs_one(object: $object, on_conflict: {constraint: requests_logs_pkey, update_columns: [message]}) {
    ...request_log
  }
}

mutation DeleteRepairRequestLog($id: uuid!) {
  delete_requests_logs_by_pk(id: $id) {
    ...request_log
  }
}


# Fragments
fragment repair_request on repair_requests {
  id
  created_at
  updated_at
  scheduled_for 
  vehicle_status {
    ...vehicle_status
  }
  description
  title
  logsCount: requests_logs_aggregate {
    aggregate {
      count
    }
  }
  vehicle {
    ...vehicle
  }
}

fragment repair_request_with_logs on repair_requests {
  id
  created_at
  updated_at
  scheduled_for 
  vehicle_status {
    ...vehicle_status
  }
  description
  title
  requests_logs(order_by: {created_at: desc}) {
    ...request_log
  }
  logsCount: requests_logs_aggregate {
    aggregate {
      count
    }
  }
  vehicle {
    ...vehicle
  }
}

fragment request_log on requests_logs {
  id
  created_at
  updated_at
  message
  user {
    ...user
  }
}


